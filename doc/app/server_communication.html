<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.2.7" />
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble,
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-right: 10%;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock {
  margin-right: 0%;
}
div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
div.olist > ol {
  list-style-type: decimal;
}
div.olist2 > ol {
  list-style-type: lower-alpha;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}

div.hlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hlist td {
  padding-bottom: 15px;
}
td.hlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
}
td.hlist2 {
  vertical-align: top;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }

/* Because IE6 child selector is broken. */
div.olist2 ol {
  list-style-type: lower-alpha;
}
div.olist2 div.olist ol {
  list-style-type: decimal;
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){generateToc(2)}
/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, October 2006. License: GPL */

function getText(el) {
  var text = "";
  for (var i = el.firstChild; i != null; i = i.nextSibling) {
    if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
      text += i.data;
    else if (i.firstChild != null)
      text += getText(i);
  }
  return text;
}

function TocEntry(el, text, toclevel) {
  this.element = el;
  this.text = text;
  this.toclevel = toclevel;
}

function tocEntries(el, toclevels) {
  var result = new Array;
  var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
  // Function that scans the DOM tree for header elements (the DOM2
  // nodeIterator API would be a better technique but not supported by all
  // browsers).
  var iterate = function (el) {
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
        var mo = re.exec(i.tagName)
        if (mo)
          result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
        iterate(i);
      }
    }
  }
  iterate(el);
  return result;
}

// This function does the work. toclevels = 1..4.
function generateToc(toclevels) {
  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementsByTagName("body")[0], toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "toc" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    document.getElementById("header").removeChild(toc);
}
/*]]>*/
</script>
<title>Server communication</title>
</head>
<body>
<div id="header">
<h1>Server communication</h1>
<span id="author">Maarten van Dootingh</span><br />
<span id="email"><tt>&lt;<a href="mailto:maarten@vdtai.nl">maarten@vdtai.nl</a>&gt;</tt></span><br />
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="para"><p>Revision history</p></div>
<div class="tableblock">
<table rules="none"
frame="hsides"
cellspacing="0" cellpadding="4">
<col width="91" />
<col width="274" />
<col width="708" />
<tbody valign="top">
  <tr>
    <td align="left">
    v1.0
    </td>
    <td align="left">
    December 21 2009
    </td>
    <td align="left">
    Conversion from hand-written html
    </td>
  </tr>
</tbody>
</table>
</div>
</div>
</div>
<h2 id="_message_types">1. Message types</h2>
<div class="sectionbody">
<div class="para"><p>The nquire server communication is 3-fold (as seen from the server):</p></div>
<div class="ilist"><ul>
<li>
<p>
<a href="nquire-discovery-protocol.html">Discovery</a> of available Nquires on a network
</p>
</li>
<li>
<p>
Barcode data messages from Nquire to server
</p>
</li>
<li>
<p>
Messages from server to NQuire (display, beep, etc).
</p>
</li>
</ul></div>
<div class="para"><p>Note that discovery can also be done using the SG15 compatebility.</p></div>
</div>
<h2 id="_protocol">2. Protocol</h2>
<div class="sectionbody">
<div class="para"><p>The server communication is done by UDP and/or TCP. The TCP connection can be in server mode or in client mode. In server mode the Nquire will listen to connections on the configured TCP port, whereas in client mode the quire will try to make the connection using the configured "remote ip address" and "tcp port". When there are multiple connections (server mode only), scanned barcode data will be sent to all connected servers and sent to the configured UDP server:port.</p></div>
<div class="para"><p>Depending on the configuration (webui), the barcode prefix will or will not be sent along with the barcode.</p></div>
<div class="para"><p>Note that scanned mifare data is prefixed with <tt>MF</tt> followed by 4 bytes (binary data) containing the barcode id.</p></div>
<div class="para"><p>Putting text on the nquire is done by a (downwards) SG15 compatible protocol: the Nquire is able to do more, so the protocol is extended:</p></div>
<div class="ilist"><ul>
<li>
<p>
The screen is bigger so "set pixel position" allows bigger values.
</p>
</li>
<li>
<p>
"select font set" is extended: values 0x32 to 0x40 represent fonts from 6px to 96px with steps of 6px.
</p>
</li>
<li>
<p>
For testing purposes there is a <em>fake scan</em> escape code.
</p>
</li>
</ul></div>
</div>
<h2 id="_supported_sg15_compatible_escaped_codes">3. Supported SG15 compatible escaped codes</h2>
<div class="sectionbody">
<h3 id="_clear_screen">3.1. clear screen</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x24</tt></pre>
</div></div>
<div class="para"><p>or</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x25</tt></pre>
</div></div>
<h3 id="_set_cursor_position">3.2. set cursor position</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x27</tt></pre>
</div></div>
<h3 id="_set_pixel_position">3.3. set pixel position</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x2c</tt></pre>
</div></div>
<h3 id="_align_string_of_text">3.4. align string of text</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>Parameter:
[0x30] = lt
[0x31] = ct
[0x32] = rt
[0x33] = lm
[0x34] = cm
[0x35] = rm
[0x36] = lb
[0x37] = cb
[0x38] = rb
[0x39] = l.
[0x3a] = c.
[0x3b] = r.
[0x3c] = .t
[0x3d] = .m
[0x3e] = .b</tt></pre>
</div></div>
<div class="para"><p>E.g. "blabla" in left top:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x2e\x30blabla\x03</tt></pre>
</div></div>
<h3 id="_nop">3.5. NOP</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x40] = NOP</tt></pre>
</div></div>
<h3 id="_nop_2">3.6. NOP</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x41] = NOP</tt></pre>
</div></div>
<h3 id="_select_font_set">3.7. select font set</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x42] = "select font set",</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>0x30 = small
0x31 = large
0x32 .. 0x40 = 6px,12px, 18px ...</tt></pre>
</div></div>
<h3 id="_reboot">3.8. reboot</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x5a] = reboot</tt></pre>
</div></div>
<h3 id="_enable_disable_scanning">3.9. enable/disable scanning</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x5b] = "enable/disable scanning",</tt></pre>
</div></div>
<h3 id="_enable_disable_backlight">3.10. enable/disable backlight</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x5c] = "enable/disable backlight",</tt></pre>
</div></div>
<h3 id="_sleep_wakeup_barcode_scanner">3.11. sleep/wakeup barcode scanner</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x5d] = "sleep/wakeup barcode scanner",</tt></pre>
</div></div>
<h3 id="_beep">3.12. beep</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x5e] = "beep",</tt></pre>
</div></div>
<h3 id="_get_firmware_version">3.13. get firmware version</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x5f] = "get firmware version",</tt></pre>
</div></div>
<h3 id="_get_firmware_version_in_sg15_format">3.14. get firmware version in SG15 format</h3><div style="clear:left"></div>
<div class="literalblock">
<div class="content">
<pre><tt>[0x60] = "get firmware version in SG15 format",</tt></pre>
</div></div>
<h3 id="_set_gpio_output">3.15. Set GPIO output</h3><div style="clear:left"></div>
<div class="para"><p>Command: [0x7E]</p></div>
<div class="para"><p>Parameter 1: OUT1 = 0x30 or <em>'0</em>', OUT2 = 0x31 or <em>'1</em>'</p></div>
<div class="para"><p>Parameter 2: low = 0x30 or <em>'0</em>', high = 0x31 or <em>'1</em>'</p></div>
<div class="para"><p>E.g. setting OUT2 to low:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x7e\x31\x30

or the equivalent:

\x7e10</tt></pre>
</div></div>
<h3 id="_get_gpio_input">3.16. Get GPIO input</h3><div style="clear:left"></div>
<div class="para"><p>Command: [0x7F]</p></div>
<div class="para"><p>Parameter: IN1 = 0x30 or <em>'0</em>', IN2 = 0x31 or <em>'1</em>'</p></div>
<div class="para"><p>E.g. requesting the state of IN1:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\x7f\x30</tt></pre>
</div></div>
<div class="para"><p>This send the value back using the following format:</p></div>
<div class="para"><p>&lt;prefix&gt;&lt;pin&gt;&lt;value&gt;</p></div>
<div class="para"><p>E.g. with the default prefix for IN1, value high:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>I01</tt></pre>
</div></div>
</div>
<h2 id="_extra_escape_codes_nquire_specific">4. Extra escape codes, nquire specific</h2>
<div class="sectionbody">
<h3 id="_display_a_picture">4.1. display a picture</h3><div style="clear:left"></div>
<div class="para"><p>Display a picture on the current pixel position. Just specify the filename, close with.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\xf0filename.gif\x03</tt></pre>
</div></div>
<h3 id="_display_touchscreen_button_picture">4.2. display touchscreen button picture</h3><div style="clear:left"></div>
<div class="para"><p>The shown picture is related to 1 or more touchscreen buttons.</p></div>
<div class="para"><p>\xf2&lt;released.gif&gt;\x0d&lt;pressed.gif&gt;\x0d&lt;position by key-id&gt;&lt;coupled to key-id&gt;n \x03</p></div>
<div class="para"><p>When "pressed.gif" is empty, the image of name-released will be inverted when pressed.</p></div>
<div class="para"><p>The names of the images should not be too long and not contain spaces together they can have 64-16-3=45 charracters</p></div>
<div class="para"><p>Touch screen position layout:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>0 1 2 3
4 5 6 7
8 9 a b
c d e f</tt></pre>
</div></div>
<div class="para"><p>E.g. display image on position 5, and associate to key 5</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\xf21.gif\x0d\x0d55\x03</tt></pre>
</div></div>
<div class="para"><p>E.g. display image on position 6, and associate to key 6 and a</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>\xf21.gif\x0d\x0d6a\x03</tt></pre>
</div></div>
<h3 id="_show_idle_message">4.3. show idle message</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>\xf3</tt></pre>
</div></div>
<h3 id="_clear_text_layer">4.4. clear text layer</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>\xf5</tt></pre>
</div></div>
<h3 id="_show_configuration">4.5. show configuration</h3><div style="clear:left"></div>
<div class="listingblock">
<div class="content">
<pre><tt>\xfe</tt></pre>
</div></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2010-04-13 21:20:33 CEST
</div>
</div>
</body>
</html>
